# Test run with one of the SOCH datasets

SOCH provided several dumps from different organizations. The dataset from the Livrustkammaren
Museum (LSH) was used for this test. The dumps contained a directory structure with a XML/RDF file for each resource and agent description. The dumps were repackaged to remove the directory structure and to use the default zip format (*.zip).

The lod-aggregator expects the data to be online and described by a dataset description. For this test a simple dataset description was created for [the collection](soch_lsh.ttl) and for [the agent descriptions](soch_lsh_agents.ttl). The dataset descriptions and the dump files were placed online on a testserver to perform the test.

Temporary URL of the datasets:

- <http://cclod.netwerkdigitaalerfgoed.nl/soch_lsh.ttl>

- <http://cclod.netwerkdigitaalerfgoed.nl/soch_lsh_agents.ttl>

## Initialize the environment

In the config file .env the variable for the provider VAR_PROVIDER was set to 'SOCH'. 

For running the scripts used in this test we must first must run the following command for the root of the lod-aggregator:

```bash
source bin/setpaths
```

## Download the datasets

```bash
crawl.sh --dataset-uri http://cclod.netwerkdigitaalerfgoed.nl/soch_lsh.ttl --output soch-lsh.nt
```

```bash
crawl.sh --dataset-uri http://cclod.netwerkdigitaalerfgoed.nl/soch_lsh_agents.ttl --output soch-lsh-agents.nt
```

The crawler downloads the zipfiles and rewrites the contents to an NTriples output format.

For further processing both files were combined to one with the following command:

```bash
cd data
cat soch-lsh.nt soch-lsh-agents.nt > soch-lsh-total.nt
```

## Fixing the raw data

The data appeared to have encoding issues that were blocking for further processing by the RDF tools. Most of the problems were incorrect encoded URLs in the 'isVisualizedBy' and 'image' fields. The [fixes.sh](fixes.sh) script was used in attempt to fix the problems using the Unix 'sed' command. 

Copy the `fixes.sh` to the data dir and run it:

```bash
# copy to the data dir and run
./fixes.sh
```

## Map the schema.org data to EDM data

The default conversion of the lod-aggregator is based on Schema.org to EDM conversion. In this case the input data is modelled using the [KSAMSÖK](http://kulturarvsdata.se/ksamsok#) Ontology. The default schema2edm query was modified for basic support for the KSAMÖK data. This is a first attempt to demonstrate the feasibility. For a full conversion a more detailled query is neccessary. The resulting query [ksamsok2edm.rq](../queries/ksamsok2edm.rq) was used to do conversion.

Next step was doing the actual conversion of the resources.

```bash
map.sh --data soch-lsh-total.nt --query ksamsok2edm.rq --output soch-lsh-edm.rdf
```

## Validate the EDM data

Next the generated EDM data was validated using a SHACL validation. See the SHACL definition in the [shacl_edm shapesfile](../shapes/shacl_edm.ttl).

```bash
validate.sh --data soch-lsh-edm.rdf
```

This resulted in no errors!  

## Prepare for delivery to Europeana

```bash
convert.sh --data soch-lsh-edm.rdf --output soch-lsh-edm.zip
```

The files generated by this test run are stored for documentation purposes under `SOCH` in the tests directory. See the [test overview](../README.md) for a link to the result file.
